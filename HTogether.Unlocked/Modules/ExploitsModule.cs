using HTogether.Patches;
using ImGuiNET;
using System.Linq;
using UnityEngine;

namespace HTogether.Modules;

[HModule]
public class ExploitsModule() : Module("Exploits", Tabs.Exploits)
{
	public int CurrentItemIndex;
	public int ItemAmount;

	public override void RenderGUIElements()
	{
		ImGui.Combo("Item", ref CurrentItemIndex, [.. GameDataPatch.ProductNames.Values], GameDataPatch.ProductNames.Count);

		ImGui.SliderInt("Amount", ref ItemAmount, 0, 300);

		if (ImGui.Button("Spawn Box"))
		{
			int id = GameDataPatch.ProductNames.Keys.ElementAt(CurrentItemIndex);
			Vector3 pos = LobbyController.Instance.LocalplayerController.transform.position;
			GameData.Instance.GetComponent<ManagerBlackboard>().CmdSpawnBoxFromPlayer(pos, id, ItemAmount, 0);
		}

		ImGui.Text("Message logger");

		if (ImGui.Button("Clear"))
		{
			PlayerObjectControllerPatch.MessageLogs.Clear();
		}

		if (ImGui.BeginTable("messageloggertable", 2, ImGuiTableFlags.Borders))
		{
			ImGui.TableSetupColumn("Player name");
			ImGui.TableSetupColumn("Message");

			ImGui.TableHeadersRow();

			foreach (var entry in PlayerObjectControllerPatch.MessageLogs)
			{
				foreach (string message in entry.Value)
				{
					ImGui.TableNextRow();
					ImGui.TableNextColumn();

					ImGui.TextUnformatted(entry.Key);

					ImGui.TableNextColumn();

					ImGui.TextUnformatted(message);
				}
			}

			ImGui.EndTable();
		}
	}
}
